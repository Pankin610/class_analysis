//---------------------------------------------------------------------------

#include <vcl.h>
#include <vector>
#include <utility>
#include <iostream>
#include <fstream>
#include <string>
#include <algorithm>
#include <random>
#include <unordered_map>
#include <ctime>
#include <windows.h>
#include <iomanip>
#include <cmath>

using namespace std;

#pragma hdrstop

#include "Unit1.h"
//---------------------------------------------------------------------------
#pragma package(smart_init)
#pragma resource "*.dfm"
TForm1 *Form1;

const int N = 55;

int n, friends[N][N], table[N][N], friend_mask[N], res = 0, best_res = -1000000000;
string name[N], filename;
bool vis[N], seatable[N][7][4];
vector< vector< pair<int, int> > > seating(7, vector< pair<int, int> >(4, make_pair(-1, -1))), best_seating(7, vector< pair<int, int> >(4, make_pair(-1, -1)));
string limits[N];

unordered_map<string, int> id;

//---------------------------------------------------------------------------
__fastcall TForm1::TForm1(TComponent* Owner)
	: TForm(Owner)
{
}
//---------------------------------------------------------------------------

inline string to_string(String x) {
	return AnsiString(x.c_str()).c_str();
}

bool validLimitation(string s) {

}

inline void readData() {
	ifstream cin("data.txt");

	cin >> n;
	for (int i = 1; i <= n; i++) {
		cin >> name[i];
		id[name[i]] = i;
		Form1->StringGrid1->Cells[0][i] = IntToStr(i);
		Form1->StringGrid1->Cells[i][0] = IntToStr(i);
	}

	for (int i = 1; i <= n; i++) {
		for (int j = 1; j <= n; j++) {
			cin >> friends[i][j];
			table[i][j] = friends[i][j];
			Form1->StringGrid1->Cells[j][i] = IntToStr(table[i][j]);
		}
	}
	for (int i = 1; i <= n; i++) {
		for (int j = i; j <= n; j++) {
			friends[i][j] = friends[j][i] = min(friends[i][j], friends[j][i]);
			if (friends[i][j] > 0) {
				friend_mask[i] |= (1 << (j - 1));
				friend_mask[j] |= (1 << (i - 1));
			}
		}
	}

	cin.ignore();
	for (int i = 1; i <= n; i++) {
		getline(cin, limits[i]);
		string res = name[i] + " | " + limits[i];
		Form1->ListBox1->Items->Add(res.c_str());
	}

	/*for (int i = 1; i <= n; i++) {
		for (int row = 1; row <= 6; row++) {
			for (int col = 1; col <= 3; col++) {
				cin >> seatable[i][row][col];
			}
		}
	}  */
}

void UpdateData() {
	ofstream cout("data.txt");

	cout << n << endl;
    for (int i = 1; i <= n; i++) {
		cout << name[i] << endl;
	}
    for (int i = 1; i <= n; i++) {
		for (int j = 1; j <= n; j++) {
			cout << table[i][j] << " ";
		}
		cout << endl;
	}
	for (int i = 1; i <= n; i++) {
        cout << limits[i] << endl;
	}
	Form1->ListBox1->Items->Clear();
	readData();
}

void __fastcall TForm1::FormCreate(TObject *Sender)
{
	  readData();
}
//---------------------------------------------------------------------------

void __fastcall TForm1::Button1Click(TObject *Sender)
{
	if (Edit1->Text == "" || Edit2->Text == "" || Edit3->Text == "") {
		ShowMessage("Неправильный формат ввода.");
		return;
	}
	if (StrToInt(Edit3->Text) < 0 || StrToInt(Edit3->Text) > 10) {
		ShowMessage("Неправильный формат ввода.");
		return;
	}

	string name1, name2;

	name1 = to_string(Edit1->Text);
	name2 = AnsiString(Edit2->Text.c_str()).c_str();

	int x = 0, y = 0;
	if (id.find(name1) != id.end()) {
		x = id[name1];
	}
	else {
		for (int i = 0; i < name1.size(); i++) {
			x = x * 10;
			x += name1[i] - '0';
			if (!(name1[i] >= '0' && name1[i] <= '9')) {
				ShowMessage("Неправильный формат ввода.");
				return;
			}
		}
	}

	if (id.find(name2) != id.end()) {
		y = id[name2];
	}
	else {
		for (int i = 0; i < name2.size(); i++) {
			y = y * 10;
			y += name2[i] - '0';
			if (!(name2[i] >= '0' && name2[i] <= '9')) {
				ShowMessage("Неправильный формат ввода.");
				return;
			}
		}
	}

	table[x][y] = StrToInt(Edit3->Text);
	UpdateData();
}
//---------------------------------------------------------------------------

void __fastcall TForm1::Button2Click(TObject *Sender)
{
	if (Edit4->Text == "" || Edit5->Text == "" || Edit6->Text == "") {
		ShowMessage("Неправильный формат ввода.");
		return;
	}
	if (StrToInt(Edit6->Text) < 0 || StrToInt(Edit6->Text) > 10) {
		ShowMessage("Неправильный формат ввода.");
		return;
	}

	string name1, name2;

	name1 = AnsiString(Edit4->Text.c_str()).c_str();
	name2 = AnsiString(Edit5->Text.c_str()).c_str();

	int x = 0, y = 0;
	if (id.find(name1) != id.end()) {
		x = id[name1];
	}
	else {
		for (int i = 0; i < name1.size(); i++) {
			x = x * 10;
			x += name1[i] - '0';
			if (!(name1[i] >= '0' && name1[i] <= '9')) {
				ShowMessage("Неправильный формат ввода.");
				return;
			}
		}
	}

	if (id.find(name2) != id.end()) {
		y = id[name2];
	}
	else {
		for (int i = 0; i < name2.size(); i++) {
			y = y * 10;
			y += name2[i] - '0';
			if (!(name2[i] >= '0' && name2[i] <= '9')) {
				ShowMessage("Неправильный формат ввода.");
				return;
			}
		}
	}

	table[x][y] = table[y][x] = StrToInt(Edit6->Text);
	UpdateData();
}
//---------------------------------------------------------------------------

void __fastcall TForm1::Button3Click(TObject *Sender)
{
	if (Edit7->Text == "" || Edit8->Text == "") {
		ShowMessage("Неправильный формат ввода.");
		return;
	}
	if (n == 36) {
		ShowMessage("Превышен лимит учеников");
		return;
	}

	string Lim  = to_string(Edit8->Text);
	string Name = to_string(Edit7->Text);

	if (!validLimitation(Lim)) {
		ShowMessage("Неправильный формат ограничения по зрению");
		return;
	}

	n++;
	name[n] = Name;
	limits[n] = lim;
	UpdateData();
}
//---------------------------------------------------------------------------

